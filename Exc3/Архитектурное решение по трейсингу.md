## Анализ системы компании и C4-диаграммы в контексте планирования трейсинга

Сущность заказа имеет сложный жизненный цикл, очень важно отслеживать какие этапы проходит заказ при обработке. А при 
возникновении зависания заказа необходимо уметь быстро определять на каком этапе возниклпа проблема. 
Внедрять сбор трассировки в БД не имеет смысла, достаточно сбора метрик в рамках мониторинга (обращение в бд будет включено в спан API сервиса). 
Сбор трассировки 

Потенциальные места потери заказа:
1. CRM может не получить информацию от MES о расчете стоимости (не произошел переход в статус PRICE_CALCULATED).
2. Произошла ошибка при переводе заказа в статус MANUFACTURING_APPROVED.
3. Недоступность заказа в MES (не получена информация о переходе заказа в статус MANUFACTURING_APPROVED).
4. Ошибка при переводе заказа в статусы MANUFACTURING_STARTED, MANUFACTURING_COMPLETED, PACKAGING, SHIPPED.

В трассировку должны попадать следующие данные:
- Идентификатор заказа
- Название системы, обрабатывающей запрос
- Название процедуры обработки
- Старт обработки
- Конец обработки
- Статус обработки (успех/неуспех)

## Мотивация

Сложный жизненный цикл заказа с обработкой в нескольких системах может привести к "потере" заказа и негативному опыту клиентов.
Без трассировки нужно потратить достаточно много времени на поиск места "потери" заказа (поиск информации по нескольким БД, 
изучение логов нескольких сервисов). Система трассировки позволит:
1. Минимизировать время расследования инцидента с "потерей" заказа (= уменьшение трудозатрат команды проекта)
2. Уменьшение количества жалоб клиентов благодаря быстрой реакции на инциденты "потери" заказов.
3. Получение информации о времени обработки заказа на разных этапах, что позволит предпринять своевременные шаги по оптимизации.
 
## Предлагаемое решение

В качестве инструмента визуального мониторинга трассировок будет использоваться Jaeger UI. Обрабатывать данные с трассировками 
будет сервер Jaeger. Хранилищем трассировок будет выступать ClickHouse. В сервисах системы (API, MQ) необходимо реализовать/внедрить адаптеры,
занимающийся отправкой информации в Jaeger.
Предполагаемый состав компонент системы: [схема трассировки](Схема%20трассировки.drawio)

## Компромиссы

Трейсинг может быть неэффективен в системах, где:

1. Затруднена модификация ПО (например, проприетарные системы).
2. Межсервисное взаимодействие происходит редко.

## Проработка аспектов безопасности

1. Внедрение аутентификации и авторизации (определение ролей, которым доступно изучение данных о трассировках)
2. Ограничение сетевого доступа (VPN, доступ только по локальной сети)
3. Шифрование данных при передачи информации о трассировках


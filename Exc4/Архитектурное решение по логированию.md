## Анализ системы компании и C4-диаграммы в контексте планирования логирования

Логи необходимо собирать из API сервисов, а также с MQ. 

### Описание собираемых логов

#### Уровень INFO

***API запросы и ответы***.  
Записываемые параметры: время запроса, endpoint, статус ответа, идентификатор сессии.

***Создание заказа***.  
Записываемые параметры: время создания, идентификатор пользователя, идентификатор заказа.

***Изменение статуса заказа***.  
Записываемые параметры: время изменения статуса, идентификатор заказа, старый статус, новый статус.

***Поступление сообщения в очередь***.  
Записываемые параметры: время поступления сообщения, название очереди, идентификатор сообщения.

***Обработка сообщения из очереди***.  
Записываемые параметры: время прочтения сообщения, название очереди, идентификатор сообщения.

#### Уровень ERROR

***Недоступность внешней системы (БД, MQ, ...)***  
Записываемые параметры: время обращения, информация о внешней системе.

***Ошибка обработки запроса***  
Записываемые параметры: время ошибки, краткое описание.

#### Уровень DEBUG

Подробная информация для разработки, предполагается использование в dev и release окружении.

## Мотивация

Внедрение логирования позволит:
1. Ускорить диагностику проблем.
2. Снизить нагрузку на команду поддержки.
3. Уменьшить время на исправление багов.

## Предлагаемое решение

Предполагается использование следующих технологий:
- Сбор и агрегация данных - ***Filebeat***
- Обработка логов - ***Logstash***
- Хранение логов - ***Elasticsearch***
- Визуализация и поиск по логам - ***Kibana***

В логи не должна записываться чувствительная информация клиентов (нужно использовать, например, объекты одноразового чтения).
К логам должен быть доступ только у сотрудников поддержки.  
Для каждого сервиса должен быть свой индекс для хранения логов. Время хранения: 30 дней. Дополнительно архив логов хранится за 1 год.

[Схема логирования](Схема логирования.drawio)

## Проработка необходимых мероприятий для превращения системы сбора логов в систему анализа логов

1. Оповещение об обнаружении логов уровня ERROR
2. Оповещение об аномальной активности (многократное увеличение запросов создания заказа)